<!DOCTYPE html>
<html lang="en" class="[scrollbar-gutter:stable]">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <.live_title suffix=" Â· Trail Chronicle">
      {assigns[:page_title] || "Trail Chronicle"}
    </.live_title>
    <link phx-track-static rel="stylesheet" href={~p"/assets/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/app.js"}>
    </script>
  </head>
  <body class="bg-white antialiased">
    <header class="fixed top-0 w-full z-50 bg-white/80 backdrop-blur-md border-b border-slate-200 transition-all duration-300">
      <nav class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex h-16 items-center justify-between">
          <!-- Logo & Desktop Nav -->
          <div class="flex items-center gap-8">
            <.link navigate={~p"/"} class="flex items-center gap-2 group z-50 relative">
              <div class="bg-gradient-to-br from-blue-600 to-indigo-600 text-white p-2 rounded-lg shadow-lg transform group-hover:rotate-3 transition-transform">
                <span class="text-xl leading-none">ğŸ”ï¸</span>
              </div>
              <span class="text-xl font-bold tracking-tight text-slate-900 group-hover:text-blue-600 transition-colors">
                Trail Chronicle
              </span>
            </.link>

            <%= if assigns[:current_athlete] do %>
              <!-- Desktop Navigation Links -->
              <div class="hidden md:flex items-center space-x-1">
                <.link
                  navigate={~p"/"}
                  class={"px-3 py-2 rounded-full text-sm font-medium transition-all " <> if @current_path == "/", do: "bg-slate-100 text-slate-900", else: "text-slate-500 hover:text-slate-900 hover:bg-slate-50"}
                >
                  {gettext("Dashboard")}
                </.link>
                <.link
                  navigate={~p"/races"}
                  class={"px-3 py-2 rounded-full text-sm font-medium transition-all " <> if String.contains?(@current_path, "/races"), do: "bg-slate-100 text-slate-900", else: "text-slate-500 hover:text-slate-900 hover:bg-slate-50"}
                >
                  {gettext("Races")}
                </.link>
                <.link
                  navigate={~p"/calendar"}
                  class={"px-3 py-2 rounded-full text-sm font-medium transition-all " <> if @current_path == "/calendar", do: "bg-slate-100 text-slate-900", else: "text-slate-500 hover:text-slate-900 hover:bg-slate-50"}
                >
                  {gettext("Calendar")}
                </.link>
                <.link
                  navigate={~p"/stats"}
                  class={"px-3 py-2 rounded-full text-sm font-medium transition-all " <> if @current_path == "/stats", do: "bg-slate-100 text-slate-900", else: "text-slate-500 hover:text-slate-900 hover:bg-slate-50"}
                >
                  {gettext("Stats")}
                </.link>
                <.link
                  navigate={~p"/gear"}
                  class={"px-3 py-2 rounded-full text-sm font-medium transition-all " <> if @current_path == "/gear", do: "bg-slate-100 text-slate-900", else: "text-slate-500 hover:text-slate-900 hover:bg-slate-50"}
                >
                  {gettext("Gear")}
                </.link>
                <.link
                  navigate={~p"/achievements"}
                  class={"px-3 py-2 rounded-full text-sm font-medium transition-all " <> if @current_path == "/achievements", do: "bg-slate-100 text-slate-900", else: "text-slate-500 hover:text-slate-900 hover:bg-slate-50"}
                >
                  {gettext("Trophies")}
                </.link>
                <.link
                  navigate={~p"/integrations"}
                  class={"px-3 py-2 rounded-full text-sm font-medium transition-all " <> if @current_path == "/integrations", do: "bg-slate-100 text-slate-900", else: "text-slate-500 hover:text-slate-900 hover:bg-slate-50"}
                >
                  {gettext("Integrations")}
                </.link>
              </div>
            <% end %>
          </div>
          
<!-- Right Side Actions -->
          <div class="flex items-center gap-2 sm:gap-4">
            <!-- Locale Switcher (Visible Desktop & Mobile) -->
            <div class="flex items-center bg-slate-100 p-1 rounded-lg border border-slate-200">
              <button
                phx-click="switch-locale"
                phx-value-locale="en"
                class={"px-2 py-1 rounded-md text-[10px] font-bold transition-all " <> if @locale == "en", do: "bg-white text-blue-600 shadow-sm", else: "text-slate-500 hover:text-slate-700"}
              >
                EN
              </button>
              <button
                phx-click="switch-locale"
                phx-value-locale="ro"
                class={"px-2 py-1 rounded-md text-[10px] font-bold transition-all " <> if @locale == "ro", do: "bg-white text-blue-600 shadow-sm", else: "text-slate-500 hover:text-slate-700"}
              >
                RO
              </button>
              <button
                phx-click="switch-locale"
                phx-value-locale="fr"
                class={"px-2 py-1 rounded-md text-[10px] font-bold transition-all " <> if @locale == "fr", do: "bg-white text-blue-600 shadow-sm", else: "text-slate-500 hover:text-slate-700"}
              >
                FR
              </button>
            </div>

            <%= if assigns[:current_athlete] do %>
              <!-- Desktop Profile Dropdown -->
              <div
                class="hidden md:flex relative ml-3"
                phx-click-away={Phoenix.LiveView.JS.hide(to: "#user-menu-dropdown")}
              >
                <button
                  type="button"
                  class="flex items-center gap-3 rounded-full bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                  id="user-menu-button"
                  phx-click={
                    Phoenix.LiveView.JS.toggle(
                      to: "#user-menu-dropdown",
                      in: "transition ease-out duration-100",
                      display: "block"
                    )
                  }
                >
                  <div class="flex flex-col items-end mr-1">
                    <span class="text-sm font-bold text-slate-900 leading-none">
                      {@current_athlete.first_name}
                    </span>
                    <span class="text-[10px] text-slate-500 uppercase tracking-wider">
                      Athlete
                    </span>
                  </div>
                  <div class="h-9 w-9 rounded-full bg-gradient-to-br from-blue-100 to-blue-50 text-blue-600 flex items-center justify-center font-bold border-2 border-white shadow-sm">
                    {String.first(@current_athlete.first_name)}
                  </div>
                </button>
                
<!-- Dropdown Menu -->
                <div
                  id="user-menu-dropdown"
                  class="absolute right-0 z-10 mt-12 w-48 origin-top-right rounded-xl bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none hidden animate-fade-in-down"
                  role="menu"
                  aria-orientation="vertical"
                  aria-labelledby="user-menu-button"
                  tabindex="-1"
                >
                  <.link
                    navigate={~p"/athletes/settings"}
                    class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 hover:text-blue-600"
                    role="menuitem"
                  >
                    âš™ï¸ {gettext("Settings")}
                  </.link>
                  <.link
                    href={~p"/athletes/log_out"}
                    method="delete"
                    class="block px-4 py-2 text-sm text-slate-700 hover:bg-red-50 hover:text-red-600"
                    role="menuitem"
                  >
                    ğŸšª {gettext("Sign out")}
                  </.link>
                </div>
              </div>
              
<!-- Mobile Menu Button -->
              <div class="flex md:hidden">
                <button
                  type="button"
                  class="relative inline-flex items-center justify-center rounded-md p-2 text-slate-400 hover:bg-slate-100 hover:text-slate-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500"
                  aria-controls="mobile-menu"
                  aria-expanded="false"
                  phx-click={
                    Phoenix.LiveView.JS.toggle(
                      to: "#mobile-menu",
                      in: "transition ease-out duration-200",
                      display: "block"
                    )
                  }
                >
                  <span class="absolute -inset-0.5"></span>
                  <span class="sr-only">Open main menu</span>
                  <svg
                    class="block h-6 w-6"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
                    />
                  </svg>
                </button>
              </div>
            <% else %>
              <div class="flex items-center gap-3">
                <.link
                  href={~p"/athletes/log_in"}
                  class="text-sm font-semibold text-slate-600 hover:text-slate-900"
                >
                  {gettext("Sign in")}
                </.link>
                <.link
                  href={~p"/athletes/register"}
                  class="bg-slate-900 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-slate-800 transition-colors shadow-lg shadow-slate-900/20"
                >
                  {gettext("Get Started")}
                </.link>
              </div>
            <% end %>
          </div>
        </div>
      </nav>
      
<!-- Mobile Menu (Hidden by default) -->
      <%= if assigns[:current_athlete] do %>
        <div
          class="hidden md:hidden bg-white/95 backdrop-blur-xl border-b border-slate-200 absolute w-full left-0 top-16 shadow-xl animate-slide-in-top"
          id="mobile-menu"
        >
          <div class="space-y-1 px-4 pb-6 pt-4">
            <!-- Mobile Links -->
            <.link
              navigate={~p"/"}
              class={"block rounded-lg px-3 py-2 text-base font-semibold leading-7 " <> if @current_path == "/", do: "bg-slate-50 text-blue-600", else: "text-slate-900 hover:bg-slate-50"}
            >
              {gettext("Dashboard")}
            </.link>
            <.link
              navigate={~p"/races"}
              class={"block rounded-lg px-3 py-2 text-base font-semibold leading-7 " <> if String.contains?(@current_path, "/races"), do: "bg-slate-50 text-blue-600", else: "text-slate-900 hover:bg-slate-50"}
            >
              {gettext("Races")}
            </.link>
            <.link
              navigate={~p"/calendar"}
              class="block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-slate-900 hover:bg-slate-50"
            >
              {gettext("Calendar")}
            </.link>
            <.link
              navigate={~p"/stats"}
              class="block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-slate-900 hover:bg-slate-50"
            >
              {gettext("Stats")}
            </.link>
            <.link
              navigate={~p"/gear"}
              class="block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-slate-900 hover:bg-slate-50"
            >
              {gettext("Gear")}
            </.link>
            <.link
              navigate={~p"/achievements"}
              class="block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-slate-900 hover:bg-slate-50"
            >
              {gettext("Trophies")}
            </.link>
            <.link
              navigate={~p"/integrations"}
              class="block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-slate-900 hover:bg-slate-50"
            >
              {gettext("Integrations")}
            </.link>
            
<!-- Mobile User Profile Section -->
            <div class="mt-6 pt-6 border-t border-slate-100">
              <div class="flex items-center gap-3 px-3 mb-4">
                <div class="h-10 w-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold border-2 border-white shadow-sm">
                  {String.first(@current_athlete.first_name)}
                </div>
                <div>
                  <div class="text-base font-bold text-slate-900">
                    {@current_athlete.first_name}
                  </div>
                  <div class="text-xs text-slate-500">{@current_athlete.email}</div>
                </div>
              </div>
              <.link
                navigate={~p"/athletes/settings"}
                class="block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-slate-700 hover:bg-slate-50"
              >
                âš™ï¸ {gettext("Account Settings")}
              </.link>
              <.link
                href={~p"/athletes/log_out"}
                method="delete"
                class="block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-red-600 hover:bg-red-50"
              >
                ğŸšª {gettext("Sign out")}
              </.link>
            </div>
          </div>
        </div>
      <% end %>
    </header>

    <main class="pt-16 min-h-screen flex flex-col bg-slate-50/50">
      <.flash_group flash={@flash} />
      <div class="flex-grow">
        {@inner_content}
      </div>
    </main>

    <footer class="bg-white border-t border-slate-200 py-12 mt-auto">
      <div class="max-w-7xl mx-auto px-4 text-center">
        <div class="flex justify-center items-center gap-2 mb-4 opacity-50 grayscale hover:grayscale-0 transition-all duration-500">
          <span class="text-2xl">ğŸ”ï¸</span>
          <span class="font-bold text-slate-900">Trail Chronicle</span>
        </div>
        <p class="text-slate-500 text-sm">
          &copy; 2025 Trail Chronicle. {gettext("Built for the mountains.")}
        </p>
      </div>
    </footer>
  </body>
</html>
